<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë“œë ˆìŠ¤ì—… í™”ë©´</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Single+Day&display=swap" rel="stylesheet">

<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    width:100vw;
    height:100vh;
    overflow:hidden;
    background:#fff;
    position:relative;
    user-select:none;
  }

  #bgmToggle {
    position: absolute;
    top: 2%;
    right: 2%;
    width: 100px;
    height: 100px;
    cursor: pointer;
    z-index: 1000; /* í•­ìƒ ìµœìƒë‹¨ */
  }

  #bgmToggle img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
  }

  /* ë¡œë”© */
  #loadingScreen {
    position:fixed;
    width:100%; height:100%;
    top:0; left:0;
    background:url('closet back.png') no-repeat center/cover;
    display:flex; justify-content:center; align-items:center;
    flex-direction:column; z-index:999;
  }

  #loadingBarWrap { width:30%; height:25px; background:rgba(255,255,255,0.6); border-radius:20px; overflow:hidden; }

  #loadingBar { width:0%; height:100%; background:#FF00BB; border-radius:20px; animation:fillBar 4s forwards ease-in-out; }

  @keyframes fillBar { 0%{width:0%} 100%{width:100%} }

  /* ë“œë ˆìŠ¤ì—… í™”ë©´ */
  #dressupScreen {
    display:none;
    position:relative;
    width:100%; height:100%;
  }

  #roomBg {
    position:absolute;
    width:100%; height:100%;
    top:0; left:0;
    object-fit:cover;
    z-index:1;
  }

  /* ì˜·ì¥ */
  #closetWrapper {
    position: relative;
    bottom:0%; left:66%;
    width:46%;
    transform:translateX(-50%);
    z-index:5;
    pointer-events:auto;
  }

  #closetImg {
    width:100%;
    display:block;
    pointer-events:none;
  }

  /* ìºë¦­í„° */
  #playerBase {
    position:absolute;
    left:22%;
    bottom:0%;
    width:201px;
    transform:translateX(-50%);
    z-index:10;
  }

 /* ê°€ë°œ ìœ„ì¹˜ */
#wearWig {
  position:absolute;
  left:22%;      /* ë¨¸ë¦¬ ì¤‘ì•™ ì¯¤ */
  top:-1%;
  transform:translateX(-50%);
  z-index:22;
  pointer-events:none;
  height:335px;
}

/* ì›í”¼ìŠ¤ ìœ„ì¹˜ */
#wearDress {
  position:absolute;
  left:22%;      /* ëª¸í†µ ì¤‘ì•™ */
  top:25%;
  transform:translateX(-50%);
  z-index:20;
  pointer-events:none;
  height:auto;
}

/* ìƒì˜ ìœ„ì¹˜ */
#wearTop {
  position:absolute;
  left:22%;      /* ìƒì²´ ì¤‘ì•™ */
  top:20%;
  transform:translateX(-50%);
  z-index:20;
  pointer-events:none;
  height:auto;
}

/* í•˜ì˜ ìœ„ì¹˜ */
#wearBottom {
  position:absolute;
  left:22%;      /* ê³¨ë°˜/ë‹¤ë¦¬ ì‹œì‘ */
  top:39%;
  transform:translateX(-50%);
  z-index:19;
  pointer-events:none;
  height:auto;
}

/* ì‹ ë°œ ìœ„ì¹˜ */
#wearShoes {
  position:absolute;
  left:22%;      /* ë°œ ì¤‘ì•™ */
  bottom:0%;
  transform:translateX(-50%);
  z-index:18;
  pointer-events:none;
  height:auto;
}

/* ì•…ì„¸ì„œë¦¬ ìœ„ì¹˜ */
#wearAcc {
  position:absolute;
  left:22%;      /* ì‚´ì§ ì˜¤ë¥¸ìª½ ìœ„ ê°™ì€ ëŠë‚Œìœ¼ë¡œ */
  top:6%;
  transform:translateX(-50%);
  z-index:21;
  pointer-events:none;
  height:auto;
}

  #wearWig { top:-1%; height:335px; }
  #wearDress { top:17%; height:450px; }
  #wearTop { top:17%; height:270px; }
  #wearBottom { top:20; height:440px; }
  #wearShoes { bottom:-2%; height:350px; }
  #wearAcc { top:16.5%; height:110px; }

  /* ê°€ë°œ ìŠ¬ë¡¯ */
  #wigSlot {
    position:absolute;
    width:100%;
    height:180px;
    top:18.5%;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:50;
    pointer-events:auto;
  }

  .arrowBtn {
    width:40px; height:40px;
    background:transparent;
    border:none; cursor:pointer;
    color:#F70093;
    font-size:30px;
    z-index:200;
  }

  .wigListWrapper {
    width:560px; height:140px;
    overflow:hidden; position:relative;
    margin:0 10px;
  }

  .wigList {
    position:absolute;
    display:flex;
    gap:7px;
    left:0px;
    transition:0.3s ease;
    list-style:none;
  }

  .wigItem { width:130px; height:130px; position:relative; }
  .wigSlotBg { position:absolute; width:130px; height:130px; z-index:1; }
  .wigImg { width:120px; height:120px; position:absolute; top:5px; left:5px; cursor:pointer; z-index:5; }

  /* ì›í”¼ìŠ¤Â·ìƒì˜Â·ì•…ì„¸ì‚¬ë¦¬ í•œ ì¤„ */
  #dressSlot{
    position:absolute;
    left:15%;   /* â† ë„¤ê°€ ì¡°ì ˆí•˜ë©´ ë¨ */
    top:40%;    /* â† ì„ì‹œê°’ */
    width:40%;
    display:flex;
    z-index:60;
  }

  .dressImg {
  width:120px;
  margin-left:-80px;   /* â† ì´ê²ƒ ë•Œë¬¸ì— ì„œë¡œ ê²¹ì³ì§! ê°’ì€ ë„¤ê°€ ì¡°ì ˆ */
}

  #topSlot {
    position:absolute;
    left:28%;   /* â† ë„¤ê°€ ì¡°ì ˆí•˜ë©´ ë¨ */
    top:40%;    /* â† ì„ì‹œê°’ */
    width:40%;
    display:flex;
    z-index:60;
  }

  .topImg {
  width:120px;
  margin-left:-50px;
}

  #accSlot {
    position:absolute;
    left:67%;   /* â† ë„¤ê°€ ì¡°ì ˆí•˜ë©´ ë¨ */
    top:45%;    /* â† ì„ì‹œê°’ */
    width:20%;
    display:flex;
    gap:10px;
    z-index:60;
  }

  .accImg {
  width:120px;
  margin-left:-35px;
}

  /* í•˜ì˜Â·ì‹ ë°œ í•œ ì¤„ */
  #bottomSlot {
    position:absolute;
    left:15%;
    top:60%;
    width:30%;
    display:flex;
    z-index:59;
  }

  .bottomImg {
  width:110px;
  margin-left:-10px;
}

  #shoesSlot {
    position:absolute;
    left:68%;
    top:58%;
    width:10%;
    display:flex;
    z-index:60;
  }

  .shoesImg {
  width:40px;
  max-width:100px;
  margin-left:-50px;
}

  /* ê³µí†µ ìŠ¤íƒ€ì¼ */
  .dressImg, .topImg, .bottomImg, .shoesImg, .accImg {
    width:120px;
    cursor:pointer;
  }

  /* ğŸ”¹ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ (ì˜·ì¥ ìœ„ ìƒë‹¨) â€“ ìƒˆë¡œ ì¶”ê°€ (ê¸°ì¡´ ìˆ˜ì¹˜ ì•ˆ ê±´ë“œë¦¼) */
  #controlButtons {
    position:absolute;
    top:100px;
    left:-50px;
    width:100%;
    padding:8px 12px;
    display:flex;
    justify-content:flex-end;
    gap:8px;
    z-index:70;
    pointer-events:none;
  }
  .controlBtn {
    width:45px;
    height:45px;
    cursor:pointer;
    pointer-events:auto;
  }

  /* ğŸ”¹ í•˜ë‹¨ ì™¸ì¶œí•˜ê¸° ë²„íŠ¼(ì¶”ê°€) */
  #goOutWrapper {
    position:absolute;
    left:90%;
    bottom:40px;
    transform:translateX(-50%);
    z-index:80;
    display:none; /* ì²˜ìŒì—” ìˆ¨ê¹€ */
  }

  #goOutButton {
    font-family: 'Single Day', cursive;
    width:220px;        /* ê³ ì • ë„ˆë¹„ */
    padding:10px 25px;
    background:#00DDFF;          /* í•˜ëŠ˜ìƒ‰ */
    border:7px solid #C0F9F6;    /* íŒŒë€ ë¼ì¸ */
    border-radius:999px;         /* íƒ€ì›í˜• */
    font-size:40px;
    font-weight:1000;
    color:#FF8BE0;
    cursor:pointer;
    box-shadow:0 4px 8px rgba(0,0,0,0.15);
      text-shadow:
    -2px  0   0 #ffffff,
     2px  0   0 #ffffff,
     0    2px 0 #ffffff,
     0   -2px 0 #ffffff,
    -2px -2px 0 #ffffff,
     2px -2px 0 #ffffff,
    -2px  2px 0 #ffffff,
     2px  2px 0 #ffffff;
  }

  /* ìš°ì¸¡ ìƒë‹¨ ì ìˆ˜ ë°•ìŠ¤ */
    #scoreBox {
      position:absolute;
      top:40px;
      right:140px;
      display:flex;
      flex-direction:column;
      align-items:center;
      z-index:200;
    }

    /* 'ì˜¤ëŠ˜ì˜ ì ìˆ˜' í…ìŠ¤íŠ¸ ì´ë¯¸ì§€ */
    #scoreTitle {
      width:250px;  /* í•„ìš”í•˜ë©´ ì¡°ì ˆ */
      margin-bottom:10px;
    }

    /* ì ìˆ˜ì°½ */
    #scoreWindow {
      position:relative;
      width:240px;   /* ì ìˆ˜ì°½ ì‚¬ì´ì¦ˆ */
      height:auto;
    }

    /* ì ìˆ˜ì°½ ë°°ê²½ ì´ë¯¸ì§€ */
    #scoreBg {
      width:100%;
      display:block;
    }

    /* ì ìˆ˜ ìˆ«ì */
    #scoreNumber {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      
      font-family: 'Single Day', cursive;
      font-size:70px;
      color:#FF4ED2;
      font-weight:900;

      text-shadow:
        -3px 0 #fff,
         3px 0 #fff,
         0 3px #fff,
         0 -3px #fff,
         2px 2px #fff,
        -2px 2px #fff,
         2px -2px #fff,
        -2px -2px #fff;

      pointer-events:none;
    }

    #scoreBox,
    #speechWrapper,
    #speechBubbleImg,
    #speechText {
      pointer-events: none;
    }

    #wearDress[src=""],
    #wearTop[src=""],
    #wearBottom[src=""],
    #wearShoes[src=""],
    #wearAcc[src=""],
    #wearWig[src=""] {
      display:none !important;
    }

    #retryButton,
    #partyButton {
        font-family: 'Single Day', cursive;
        width:220px;
        padding:10px 25px;
        bottom:40px;        /* í™”ë©´ ì•„ë˜ì—ì„œ 40px */
        right:40px; 
        background:#FF7FD7;
        border:7px solid #E300A7;
        border-radius:999px;
        font-size:40px;
        font-weight:1000;
        color:#FFFFFF;
        cursor:pointer;
        box-shadow:0 4px 8px rgba(0,0,0,0.15);
        text-shadow:
          -2px 0 #F70093,
           2px 0 #F70093,
           0 2px #F70093,
           0 -2px #F70093,
          -2px -2px #F70093,
           2px -2px #F70093,
          -2px 2px #F70093,
           2px 2px #F70093;
    }

</style>
</head>

<body>

<!-- ğŸ”Š BGM ì˜¤ë””ì˜¤ -->
<audio id="bgm" loop>
  <source src="sdlkfjlsdk.mp3" type="audio/mpeg">
</audio>

<!-- ğŸ”Š BGM í† ê¸€ ë²„íŠ¼ -->
<div id="bgmToggle">
  <img id="bgmIcon" src="Group 2085666441.png">
</div>

<!-- ë¡œë”© -->
<div id="loadingScreen">
  <img id="loadingText" src="Loading....png">
  <div id="loadingBarWrap"><div id="loadingBar"></div></div>
</div>

<!-- ë©”ì¸ -->
<div id="dressupScreen">

  <img id="roomBg" src="Frame 2087327010.png">

  <div id="closetWrapper">
    <img id="closetImg" src="Group 2085666421.png">

    <!-- ğŸ”¹ ì˜·ì¥ ìœ„ ìƒë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
    <div id="controlButtons">
      <!-- íŒŒì¼ ì´ë¦„ì€ ë„¤ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ë°”ê¿” ì¨ë„ ë¨ -->
      <img id="undoBtn"  class="controlBtn" src="Group 2085666422.png"  alt="undo">
      <img id="resetBtn" class="controlBtn" src="Group 2085666424.png" alt="reset">
    </div>

    <!-- ê°€ë°œ ìŠ¬ë¡¯ -->
    <div id="wigSlot">
      <button id="leftArrow" class="arrowBtn">â—€</button>

      <div class="wigListWrapper">
        <ul class="wigList" id="wigList">
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="basic hair.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="gold ponytail.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="pink hair 2.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="hairbun.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="long hair.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="red hair.png"></li>
        </ul>
      </div>

      <button id="rightArrow" class="arrowBtn">â–¶</button>
    </div>

    <!-- ì›í”¼ìŠ¤ -->
    <div id="dressSlot">
      <img class="dressImg" src="dress1.png">
      <img class="dressImg" src="dress2.png">
    </div>

    <!-- ìƒì˜ -->
    <div id="topSlot">
      <img class="topImg" src="top1.png">
      <img class="topImg" src="top2.png">
      <img class="topImg" src="top3.png">
      <img class="topImg" src="top4.png">
    </div>

    <!-- ì•…ì„¸ì„œë¦¬ -->
    <div id="accSlot">
      <img class="accImg" src="acc1.png">
      <img class="accImg" src="acc2.png">
      <img class="accImg" src="acc3.png">
      <img class="accImg" src="acc4.png">
    </div>

    <!-- í•˜ì˜ -->
    <div id="bottomSlot">
      <img class="bottomImg" src="bottom1.png">
      <img class="bottomImg" src="bottom2.png">
      <img class="bottomImg" src="bottom3.png">
    </div>

    <!-- ì‹ ë°œ -->
    <div id="shoesSlot">
      <img class="shoesImg" src="shoes1.png">
      <img class="shoesImg" src="shoes2.png">
      <img class="shoesImg" src="shoes3.png">
      <img class="shoesImg" src="shoes4.png">
    </div>

  </div>

  <!-- ì°©ìš© ë ˆì´ì–´ -->
  <img id="playerBase" src="Group 2085666411.png">
  <img id="wearDress">
  <img id="wearTop">
  <img id="wearBottom">
  <img id="wearShoes">
  <img id="wearAcc">
  <img id="wearWig">

  <!-- ğŸ”¹ ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ (ì¶”ê°€) -->
  <div id="goOutWrapper">
    <button id="goOutButton">ì™¸ì¶œí•˜ê¸°</button>
  </div>

  <audio id="clickSfx" src="shine-7-268909.mp3"></audio>

</div>

<!-- ì™¸ì¶œ í›„ í™”ë©´ -->
<div id="outScreen" style="display:none; position:relative; width:100%; height:100%;">

  <!-- ìƒˆë¡œìš´ ë°°ê²½ -->
  <img id="outBg" src="5d5a46e4-488f-4ab1-a1ee-0d2d21d7038c 1.png"
       style="position:absolute; width:100%; height:100%; object-fit:cover; left:0; top:0;">

    <!-- â­ ìê¸°ì†Œê°œìš© ì†Œë…„ ì´ë¯¸ì§€ -->
  <img id="introBoy"
       src="Group 2085666447.png" 
       style="
         display:none;
         position:absolute;
         right:50%;
         top:0%;
         transform:translateX(50%);
         width:450px;
         z-index:50;
       ">
       
  <!-- â­ ìê¸°ì†Œê°œ ëŒ€í™”ì°½ -->
  <div id="introDialogueBox"
       style="
         display:none;
         position:absolute;
         left:50%;
         bottom:20px;
         transform:translateX(-50%);
         width:95%;
         max-width:1400px;
         height:200px;
         padding:25px 30px;
         background: linear-gradient(90deg, #FFE9FD, #ffffff);
         border-radius:20px;
         outline:3px dotted #E300EE;
         outline-offset:-5px;
         box-shadow:-2 0 10px 4px rgba(212, 0, 183, 1);
         font-family:'Single Day', cursive;
         cursor:pointer;
         z-index:60;
       ">
    
    <div id="introDialogueName"
         style="
           font-size:30px;
           font-weight:bold;
           color:#FFFFFF;
           text-shadow:-3px 0 0 #E300EE,
                        3px 0 0 #E300EE,
                        0 -3px 0 #E300EE,
                        0 3px 0 #E300EE,
                        -3px -3px 0 #E300EE,
                        -3px 3px 0 #E300EE,
                        3px -3px 0 #E300EE,
                        3px 3px 0 #E300EE;
           margin-bottom:8px;
           white-space:nowrap;
         ">
    </div>

    <div id="introDialogueText"
         style="
           font-size:25px;
           color:#FF00BB;
           line-height:1.5;
           white-space:normal;
           word-break:keep-all;
         ">
    </div>

  </div>

  <!-- â­ ì™¼ìª½: ì—¬ì ìºë¦­í„° -->
  <div id="playerOutWrapper" style="position:absolute; left:40%; bottom:0; transform:translateX(-50%); width:220px; height:600px;">

    <img id="playerOutBase"
         src="Group 2085666411.png"
         style="position:absolute; left:50%; bottom:0; transform:translateX(-50%); width:160px; height:700px; z-index:10;">

    <img id="outWearWig"    style="position:absolute; left:50%; top:-18%; transform:translateX(-50%); z-index:22; height:270px;">
    <img id="outWearDress"  style="position:absolute; left:50%; top:3%; transform:translateX(-50%); z-index:20; height:380px;">
    <img id="outWearTop"    style="position:absolute; left:50%; top:3%; transform:translateX(-50%); z-index:20; height:200px;">
    <img id="outWearBottom" style="position:absolute; left:50%; top:28%; transform:translateX(-50%); z-index:19; height:365px;">
    <img id="outWearShoes"  style="position:absolute; left:50%; bottom:-2%; transform:translateX(-50%); z-index:18; height:270px;">
    <img id="outWearAcc"    style="position:absolute; left:50%; top:1%; transform:translateX(-50%); z-index:21; height:110px;">

  </div>

    <!-- â­ ìš°ì¸¡ ìƒë‹¨ ì ìˆ˜ ë°•ìŠ¤ -->
  <div id="scoreBox">
    <img id="scoreTitle" src="Group 2085666358.png">
    <div id="scoreWindow">
      <img id="scoreBg" src="Group 2085666444.png">
      <div id="scoreNumber">89ì </div>
    </div>
  </div>

  <!-- â­ ì˜¤ë¥¸ìª½: ë‚¨ì ìºë¦­í„° -->
  <img id="boyBase"
       src="boy123.png"
       style="position:absolute; right:45%; bottom:0; transform:translateX(50%); width:260px; z-index:10;">

  <!-- â­ ì ìˆ˜ ë§í’ì„  -->
  <div id="speechWrapper"
       style="position:absolute; right:30%; top:30%; width:200px; pointer-events:none;">

      <img id="speechBubbleImg"
           src="Union.png"
           style="width:100%; pointer-events:none;">

      <div id="speechText"
           style="
             position:absolute;
             top:26%;
             left:50%;
             transform:translateX(-50%);
             width:180px;
             text-align:center;
             font-size:25px;
             font-weight:600;
             color:#FFFBCB;
             font-family: 'Single Day', cursive;
                   text-shadow:
        -2px 0 #FF58D5,
         2px 0 #FF58D5,
         0 2px #FF58D5,
         0 -2px #FF58D5,
         2px 2px #FF58D5,
        -2px 2px #FF58D5,
         2px -2px #FF58D5,
        -2px -2px #FF58D5;
           ">
</div>
</div>

<!-- â­ í•˜ë‹¨ ë²„íŠ¼ ë°•ìŠ¤ -->
<div id="resultButtons" style="
     display:none;
     position:absolute;
     right:40px;
     bottom:40px;
     gap:20px;
     z-index:300;
">
  <button id="retryButton">ë‹¤ì‹œ í•˜ê¸°</button>
  <button id="partyButton">íŒŒí‹° ê°€ê¸°</button>
</div>

</div>

<script>

  const clickSfx = document.getElementById("clickSfx");

  /* =========================================================
     ğŸ”Š ê¸€ë¡œë²Œ BGM í† ê¸€
  ========================================================= */
  const bgmAudio = document.getElementById('bgm');
  const bgmToggle = document.getElementById('bgmToggle');
  const bgmIcon = document.getElementById('bgmIcon');

  let isBgmPlaying = false;

  bgmToggle.addEventListener('click', () => {
    if (isBgmPlaying) {
      bgmAudio.pause();
      bgmIcon.src = "Group 2085666441.png";   // êº¼ì§„ ì´ë¯¸ì§€
    } else {
      bgmAudio.play();
      bgmIcon.src = "Group 2085666442.png";    // ì¼œì§„ ì´ë¯¸ì§€
    }
    isBgmPlaying = !isBgmPlaying;
  });

const playerName = localStorage.getItem("playerName") || "í”Œë ˆì´ì–´";
const playerTitle = localStorage.getItem("playerTitle") || "";

const loadingScreen  = document.getElementById("loadingScreen");
const dressupScreen  = document.getElementById("dressupScreen");

/* ìºë¦­í„° & ì°©ìš© ë ˆì´ì–´ ìš”ì†Œë“¤ */
const playerBase  = document.getElementById("playerBase");
const wearWig     = document.getElementById("wearWig");
const wearDress   = document.getElementById("wearDress");
const wearTop     = document.getElementById("wearTop");
const wearBottom  = document.getElementById("wearBottom");
const wearShoes   = document.getElementById("wearShoes");
const wearAcc     = document.getElementById("wearAcc");

/* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
const undoBtn  = document.getElementById("undoBtn");
const resetBtn = document.getElementById("resetBtn");

/* ğŸ”¹ ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ */
const goOutWrapper = document.getElementById("goOutWrapper");
const goOutButton  = document.getElementById("goOutButton");

// ===================================
// ğŸ”¹ í™”ì‚´í‘œ ë²„íŠ¼ ì½”ë“œ (ì—¬ê¸°ì— ì¶”ê°€!)
// ===================================
const leftArrow = document.getElementById("leftArrow");
const rightArrow = document.getElementById("rightArrow");
const wigList = document.getElementById("wigList");

leftArrow.addEventListener("click", () => {
  const currentLeft = parseInt(window.getComputedStyle(wigList).left);
  wigList.style.left = (currentLeft + 50, 0) + "px";
});

rightArrow.addEventListener("click", () => {
  const currentLeft = parseInt(window.getComputedStyle(wigList).left);
  wigList.style.left = (currentLeft - 50, -260) + "px";
});

setTimeout(() => {
  loadingScreen.style.display  = "none";
  dressupScreen.style.display  = "block";
}, 1000);

/* íˆìŠ¤í† ë¦¬ */
let historyStack = [];

function getCurrentState() {
  return {
    wig:    wearWig.src   || "",
    dress:  wearDress.src || "",
    top:    wearTop.src   || "",
    bottom: wearBottom.src|| "",
    shoes:  wearShoes.src || "",
    acc:    wearAcc.src   || ""
  };
}

function applyState(state) {
  wearWig.src    = state.wig    || "";
  wearDress.src  = state.dress  || "";
  wearTop.src    = state.top    || "";
  wearBottom.src = state.bottom || "";
  wearShoes.src  = state.shoes  || "";
  wearAcc.src    = state.acc    || "";
}


function pushHistory() {
  historyStack.push(getCurrentState());
}

/* ë¡œë”© ì™„ë£Œ í›„ ì‹¤í–‰ */
window.onload = () => {
  pushHistory();
};

undoBtn.addEventListener("click", () => {
  if (historyStack.length <= 1) return;
  historyStack.pop();
  applyState(historyStack[historyStack.length - 1]);
});

resetBtn.addEventListener("click", () => {
  const emptyState = { wig:"", dress:"", top:"", bottom:"", shoes:"", acc:"" };
  applyState(emptyState);
  historyStack = [emptyState];
});

/* ë“œë˜ê·¸ */
let dragImg=null, dragSrc="", offsetX=0, offsetY=0;
let activeSlotId=null, activeClearFunc=null;

function setupDrag(selector, targetId, clearFunc){
  document.querySelectorAll(selector).forEach(img=>{
    img.addEventListener("mousedown", e=>{
      e.preventDefault();
      dragSrc = img.src;

      const rect = img.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;

      dragImg = img.cloneNode(true);
      dragImg.style.position="absolute";
      dragImg.style.zIndex=999;
      dragImg.style.left=rect.left+"px";
      dragImg.style.top=rect.top+"px";
      dragImg.style.pointerEvents="none";

      document.body.appendChild(dragImg);

      activeSlotId = targetId;
      activeClearFunc = clearFunc || null;
    });
  });
}

document.addEventListener("mousemove", e=>{
  if(!dragImg) return;
  dragImg.style.left = (e.clientX-offsetX)+"px";
  dragImg.style.top  = (e.clientY-offsetY)+"px";
});

document.addEventListener("mouseup", e=>{
  if(!dragImg) return;

  const R = playerBase.getBoundingClientRect();
  const inside =
    e.clientX>R.left && e.clientX<R.right &&
    e.clientY>R.top  && e.clientY<R.bottom;

if (inside && activeSlotId){
    const slot=document.getElementById(activeSlotId);
    if (slot) {
      pushHistory();
      if (activeClearFunc) activeClearFunc();
      slot.src = dragSrc;

      // â­ ì°©ìš© íš¨ê³¼ìŒ ì¶”ê°€
      if (clickSfx) {
        clickSfx.currentTime = 0;
        clickSfx.play().catch(()=>{});
      }
    }
}

  dragImg.remove();
  dragImg=null;
  dragSrc="";
  activeSlotId=null;
  activeClearFunc=null;
});

/* ì ìš© ê·œì¹™ */
setupDrag(".wigImg", "wearWig");
setupDrag(".dressImg", "wearDress", ()=>{ wearTop.src=""; wearBottom.src=""; });
setupDrag(".topImg", "wearTop", ()=>{ wearDress.src=""; });
setupDrag(".bottomImg", "wearBottom", ()=>{ wearDress.src=""; });
setupDrag(".shoesImg", "wearShoes");
setupDrag(".accImg", "wearAcc");

/* ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ */
function updateGoOutVisibility() {
  const hasItem =
    (wearWig.src && wearWig.src.trim() !== "") ||
    (wearDress.src && wearDress.src.trim() !== "") ||
    (wearTop.src && wearTop.src.trim() !== "") ||
    (wearBottom.src && wearBottom.src.trim() !== "") ||
    (wearShoes.src && wearShoes.src.trim() !== "") ||
    (wearAcc.src && wearAcc.src.trim() !== "");

  goOutWrapper.style.display = hasItem ? "block" : "none";
}
setInterval(updateGoOutVisibility, 200);

/* OUT í™”ë©´ ìš”ì†Œ */
const outScreen     = document.getElementById("outScreen");
const outWearWig    = document.getElementById("outWearWig");
const outWearDress  = document.getElementById("outWearDress");
const outWearTop    = document.getElementById("outWearTop");
const outWearBottom = document.getElementById("outWearBottom");
const outWearShoes  = document.getElementById("outWearShoes");
const outWearAcc    = document.getElementById("outWearAcc");

/* âœ” íŠ¹ì • ì˜· ì ìˆ˜ */
const scoreBoostItems = {
  dress: ["dress2.png"],
  wig: ["red hair.png"]
};

/* âœ” ì ìˆ˜ ê³„ì‚° */
function calculateScore() {
  let score = 30;
  const state = getCurrentState();

  for (let key in scoreBoostItems) {
    const wearing = state[key];
    if (!wearing) continue;

    const file = wearing.split("/").pop();
    if (scoreBoostItems[key].includes(file)) {
      score = 70;
    }
  }
  return score;
}

/* â­ ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ */
function animateScore(finalScore) {
  const scoreElem = document.getElementById("scoreNumber");
  let steps = 25;
  let interval = 40;
  let count = 0;

  const timer = setInterval(() => {
    count++;
    scoreElem.innerText = Math.floor(Math.random()*100);

    if (count >= steps) {
      clearInterval(timer);
      scoreElem.innerText = finalScore;
    }
  }, interval);
}

/* â­ ë§í’ì„  ì—…ë°ì´íŠ¸ */
const speechBubbleImg = document.getElementById("speechBubbleImg");
const speechText      = document.getElementById("speechText");

function updateSpeech(score) {
  if (score >= 50) {
    speechBubbleImg.src = "Union.png";
    speechText.innerText = `${playerName}, ê·¸ë‚˜ë§ˆ \në´ì¤„ë§Œí•˜ë„¤... \níŒŒí‹°ì— ê°€ì`;
  }
  else if (score <= 30) {
    speechBubbleImg.src = "Union.png";
    speechText.innerText = `${playerName}, ê·¸ ì˜·ì„ \nì…ê³  íŒŒí‹°ì— \nê°€ê² ë‹¤ê³ ?`;
  }
  else {
    speechBubbleImg.src = "Union.png";
    speechText.innerText = "ìŒâ€¦ ë¬´ë‚œí•œë°?";
  }
}

/* â­ ì™¸ì¶œí•˜ê¸° */
function goToOutScreen() {

  dressupScreen.style.display="none";
  outScreen.style.display="block";

  // ê¸°ì¡´ ë³µì‚¬
  outWearWig.src    = wearWig.src;
  outWearDress.src  = wearDress.src;
  outWearTop.src    = wearTop.src;
  outWearBottom.src = wearBottom.src;
  outWearShoes.src  = wearShoes.src;
  outWearAcc.src    = wearAcc.src;

  // â­ ì ìˆ˜ ë° ë§í’ì„ ì€ ì ì‹œ ìˆ¨ê¹€
  document.getElementById("scoreBox").style.display = "none";
  document.getElementById("speechWrapper").style.display = "none";
  document.getElementById("boyBase").style.display = "none";

  // â­ ìê¸°ì†Œê°œ ì´ë¯¸ì§€ + ëŒ€í™”ì°½ í‘œì‹œ
  introBoy.style.display = "block";
  introDialogueBox.style.display = "block";

  document.getElementById("playerOutWrapper").style.display = "none"; // ì†Œë…€ ìˆ¨ê¹€
  document.getElementById("playerOutBase").style.display = "none";    // í˜¹ì‹œ ë”°ë¡œ ìˆì„ ê²½ìš°

  // â­ ëŒ€ì‚¬ ë‚´ìš©
  let introIndex = 0;

  const introLines = [
    { name:"???", text:`ì•ˆë…• ${playerName}?` },
    { name:"???" , text:"ë‚˜ëŠ” ë„ˆì™€ í•¨ê»˜ íŒŒí‹°ì— ê°ˆ íŒŒíŠ¸ë„ˆ ì›ë¹ˆì´ì•¼" },
    { name:"ì›ë¹ˆ", text:"ë‚˜ì™€ í•¨ê»˜ íŒŒí‹°ì— ê°€ê¸° ìœ„í•´ì„œëŠ” íŒŒí‹°ì˜ ë¶„ìœ„ê¸°ì— ë§ëŠ” ì˜·ì„ ì…ì–´ì•¼ í•´" },
    { name:"ì›ë¹ˆ", text:"ìŒ... ë„ˆì˜ ì˜·ì´ íŒŒí‹° ë¶„ìœ„ê¸°ì— ë§ëŠ”ì§€ ì•ˆ ë§ëŠ”ì§€ ì•Œë ¤ì¤„ê²Œ" },
    { name:"ì›ë¹ˆ", text:"50ì ì´ ë„˜ì–´ì•¼ë§Œ ë‚˜ì™€ í•¨ê»˜ ë‚˜ê°ˆ ìˆ˜ ìˆì–´" }
  ];

  function renderIntro(){
    introDialogueName.textContent = introLines[introIndex].name;
    introDialogueText.textContent = introLines[introIndex].text;
  }

  renderIntro();

  // â­ í´ë¦­í•˜ë©´ ë‹¤ìŒ ëŒ€ì‚¬ â†’ ëë‚˜ë©´ í‰ê°€ í™”ë©´ ì‹œì‘
  introDialogueBox.onclick = () => {

    introIndex++;

    if(introIndex >= introLines.length){
      // ì†Œê°œ ì¢…ë£Œ
      introDialogueBox.style.display = "none";
      introBoy.style.display = "none";

       // â­ ì—¬ê¸°ì„œë§Œ ì†Œë…€ ë‹¤ì‹œ ë³´ì—¬ì¤Œ (ìê¸°ì†Œê°œ ëë‚œ ë’¤!)
      document.getElementById("playerOutWrapper").style.display = "block";
      document.getElementById("playerOutBase").style.display = "block";

      // ê¸°ì¡´ boy ì´ë¯¸ì§€ + ì ìˆ˜ UI í™œì„±í™”
      document.getElementById("boyBase").style.display = "block";
      document.getElementById("scoreBox").style.display = "block";
      document.getElementById("speechWrapper").style.display = "block";

      // ì ìˆ˜ ê³„ì‚° ë¡œì§ ì‹¤í–‰
      const score = calculateScore();
      animateScore(score);
      updateSpeech(score);

      // â­ ì ìˆ˜ ê²°ê³¼ ë²„íŠ¼ í‘œì‹œ
    resultButtons.style.display = "flex";

    if (score <= 40) {
      retryButton.style.display = "block";
      partyButton.style.display = "none";
    }
    else if (score >= 50) {
      retryButton.style.display = "none";
      partyButton.style.display = "block";
    } else {
      retryButton.style.display = "none";
      partyButton.style.display = "none";
    }

    retryButton.onclick = () => {
      resultButtons.style.display = "none";
      outScreen.style.display = "none";
      dressupScreen.style.display = "block";
    };

    partyButton.onclick = () => {
    window.location.href = "partyScene.html"; 
    };

      return;
    }

    renderIntro();
  };
}

/* â­ ë²„íŠ¼ í´ë¦­ */
goOutButton.addEventListener("click", goToOutScreen);

</script>

</body>
</html>